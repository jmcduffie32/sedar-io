<!DOCTYPE html>
<html>
  <head>
    <title>Sedario AI Test Page</title>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">

    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

    <meta http-equiv="cache-control" content="no-cache" />

    <style>

      body {
        margin-bottom: 100px;
      }

      p, button {
        font-family: monospace;
      }

      div.console-out {
        background-color: black !important;
        color: white;
        padding-left: 3px;
      }

      h3 {
        margin-top:40px;
      }

      .layout > tbody > tr > td {
        padding: 2px;
        text-align: center;
        border: 1px solid grey;
        background-color: lightgrey;
      }

      .selected-white {
        background-color: white !important;
      }

      .selected-black {
        background-color: black !important;
        color: white;
      }

      #play-styles > tr > td {
        text-align: center;
      }

    </style>

  </head>
  <body>
    <script src="js/State.js"></script>
    <script src="js/AI.js"></script>

    <div class="container">
      <div class="jumbotron">
        <div class="row">
          <div class="col-lg-8">
            <h1>Sedario AI test page</h1>
            <h2><a href="index.html" target="_blank">Go to Game</a></h2>
          </div>
          <div class="col-sm-4">
            <button type="button" class="btn btn-warning btn-lg btn-block" onclick="location.reload(true)">location.reload(true)</button>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-lg-12">
          <div class="panel panel-default">
            <div class="panel-heading">
              <div class="row">
                <div class="col-md-6">
                  <button type="button" class="btn btn-primary" onclick="fight();">fight()</button>
                </div>
                <div class="col-md-6 text-right">
                  <button type="button" class="btn btn-danger right-block" onclick="document.getElementById('fight').innerHTML='>>> ';">Clear Output</button>
                </div>
              </div>
            </div>
            <div class="panel-body">
              <div class="row">
                <div class="col-md-6">
                  <table class="table">
                    <thead>
                      <tr>
                        <th></th>
                        <th style="text-align: center;">White</th>
                        <th style="text-align: center;">Black</th>
                      </tr>
                    </thead>
                    <tbody id="play-styles">
                    </tbody>
                  </table>
                </div>

                <div class="col-md-3">
                  <div class="form-group">
                    <label>
                      Number of games to play: <input type="number" class="form-control" id="numGames" value="100"></input>
                    </label>
                    <label>
                      Initial White Position: <input type="number" class="form-control" id="white_start" value="3" oninput="select_square('white', this.value)"></input>
                    </label>
                    <label>
                      Initial Black Position: <input type="number" class="form-control" id="black_start" value="60" onupdate="select_square('black', this.value)"></input>
                    </label>
                  </div>
                </div>
                <div class="col-md-3">
                  <table class="table layout">
                    <tr>
                      <td id="cell-0">0</td>
                      <td id="cell-1">1</td>
                      <td id="cell-2">2</td>
                      <td id="cell-3" class="selected-white">3</td>
                      <td id="cell-4">4</td>
                      <td id="cell-5">5</td>
                      <td id="cell-6">6</td>
                      <td id="cell-7">7</td>
                    </tr>
                    <tr>
                      <td id="cell-8">8</td>
                      <td id="cell-9">9</td>
                      <td id="cell-10">10</td>
                      <td id="cell-11">11</td>
                      <td id="cell-12">12</td>
                      <td id="cell-13">13</td>
                      <td id="cell-14">14</td>
                      <td id="cell-15">15</td>
                    </tr>
                    <tr>
                      <td id="cell-16">16</td>
                      <td id="cell-17">17</td>
                      <td id="cell-18">18</td>
                      <td id="cell-19">19</td>
                      <td id="cell-20">20</td>
                      <td id="cell-21">21</td>
                      <td id="cell-22">22</td>
                      <td id="cell-23">23</td>
                    </tr>
                    <tr>
                      <td id="cell-24">24</td>
                      <td id="cell-25">25</td>
                      <td id="cell-26">26</td>
                      <td id="cell-27">27</td>
                      <td id="cell-28">28</td>
                      <td id="cell-29">29</td>
                      <td id="cell-30">30</td>
                      <td id="cell-31">31</td>
                    </tr>
                    <tr>
                      <td id="cell-32">32</td>
                      <td id="cell-33">33</td>
                      <td id="cell-34">34</td>
                      <td id="cell-35">35</td>
                      <td id="cell-36">36</td>
                      <td id="cell-37">37</td>
                      <td id="cell-38">38</td>
                      <td id="cell-39">39</td>
                    </tr>
                    <tr>
                      <td id="cell-40">40</td>
                      <td id="cell-41">41</td>
                      <td id="cell-42">42</td>
                      <td id="cell-43">43</td>
                      <td id="cell-44">44</td>
                      <td id="cell-45">45</td>
                      <td id="cell-46">46</td>
                      <td id="cell-47">47</td>
                    </tr>
                    <tr>
                      <td id="cell-48">48</td>
                      <td id="cell-49">49</td>
                      <td id="cell-50">50</td>
                      <td id="cell-51">51</td>
                      <td id="cell-52">52</td>
                      <td id="cell-53">53</td>
                      <td id="cell-54">54</td>
                      <td id="cell-55">55</td>
                    </tr>
                    <tr>
                      <td id="cell-56">56</td>
                      <td id="cell-57">57</td>
                      <td id="cell-58">58</td>
                      <td id="cell-59">59</td>
                      <td id="cell-60" class="selected-black">60</td>
                      <td id="cell-61">61</td>
                      <td id="cell-62">62</td>
                      <td id="cell-63">63</td>
                    </tr>
                    </table>
                </div>
              </div>
            </div>
            <div class="panel-footer console-out">
              <p id="fight">>>> </p>
            </div>
          </div>
        </div>
      </div>
      <div class="row" style="margin-top: 40px;">
        <div class="col-md-12" id="descriptions">
          <h2>AI Style Descriptions</h2>
        </div>
      </div>
    </div>
  </body>

  <script>

    function select_square(color, number) {
      if (number == "") {return;}
      if (isNaN(number) || (number % 1 != 0) || (number > 61) || (number < 0)) {
        alert("input must be an integer in [0,61].");
        return;
      }
      // clear current selection
      var curr = document.getElementsByClassName('selected-' + color);
      for (var i = 0; i < curr.length; i++) {
        curr[i].classList.remove('selected-' + color);
      }
      document.getElementById("cell-" + number).classList.add('selected-' + color);

      document.getElementById(color + '_start').value = number;
    }



    // load styles
    for (var i = 0; i < all_AI_list.length; i++) {
      var tr = document.createElement('tr');

      var func_name_th = document.createElement('th');
      func_name_th.appendChild(document.createTextNode(all_AI_list[i].name));
      tr.appendChild(func_name_th);

      for (var c = 0; c < 2; c++) {
        var select_td = document.createElement('td');
        var select = document.createElement('input');
        select.setAttribute('type', 'radio');
        select.setAttribute('name', c == 0 ? 'white' : 'black');
        select.value = all_AI_list[i].name;
        if (i == 0) {
          select.checked = true;
        }
        select_td.appendChild(select);
        tr.appendChild(select_td);
      }
      document.getElementById('play-styles').appendChild(tr);


      // style descriptions

      var h3 = document.createElement('h3');
      h3.appendChild(document.createTextNode(all_AI_list[i].name));
      var p = document.createElement('p');
      p.appendChild(document.createTextNode(all_AI_list[i].description));
      document.getElementById('descriptions').appendChild(h3);
      document.getElementById('descriptions').appendChild(p);

    }



    function print(string) {
      document.getElementById('run').innerHTML += string + "<br>>>> "; console.log(string);
    }



    var empty_board = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];



    function play_game(white_func, black_func, white_start, black_start) {
     var game_state = new State(empty_board, [], [white_start, black_start], 0);
     game_state.board[white_start] = 2;
     game_state.board[black_start] = 3;
     while (game_state.get_possible_moves().length != 0) { // while game is not over
       if (game_state.current_player == 0) {
         var move = white_func(game_state.board, game_state.arrow, game_state.player_pos, game_state.current_player);
       } else {
         var move = black_func(game_state.board, game_state.arrow, game_state.player_pos, game_state.current_player);
       }
       game_state.move_to(move);
     }
     return 1 - game_state.current_player;
    }






    function fight() {
      document.getElementById('fight').innerHTML = ">>> loading...";
      var white_func = eval(document.querySelector('input[name="white"]:checked').value);
      var black_func = eval(document.querySelector('input[name="black"]:checked').value);

      var num_games = Number(document.getElementById('numGames').value);
      var white_start = Number(document.getElementById('white_start').value);
      var black_start = Number(document.getElementById('black_start').value);

      var num_white_wins = 0;
      for (var i = 0; i < num_games; i++) {
       num_white_wins += play_game(white_func, black_func, white_start, black_start) == 0 ? 1 : 0;
      }

      document.getElementById('fight').innerHTML =
        "White (" + white_func.name + ") wins: " + num_white_wins
          + " (" + (num_white_wins * 100 / num_games) + "%)<br>" +
        "Black (" + black_func.name + ") wins: " + (num_games - num_white_wins)
          + " (" + ((num_games - num_white_wins) * 100 / num_games) + "%)" ;
    }



  </script>
</html>




<!---
 Grave yard:



/**
  experimental and VERY SLOW => do not use
**/
// function monte_carlo(board, arrow, player_pos, current_player) {
//   var game_state = new State(board, arrow, player_pos, current_player);
//   var val = -Infinity;
//   var best_child = null;
//   var children = game_state.expand();
//   for (var i in children) {
//     var child = children[i];
//     var white_pos = child.board.indexOf(WHITE);
//     var black_pos = child.board.indexOf(BLACK);
//     var num_wins = 0;
//     for (var j = 0; j < 100; j++) {
//       if (play_game(random_play, random_play, white_pos, black_pos) == current_player) {
//         num_wins += 1;
//       }
//     }
//     if (num_wins >= val) {
//       best_child = child;
//     }
//   }
//   return best_child.player_pos[1 - best_child.current_player];
// }


//
// function run() {
//
//  // search for best coefficients on strategies against random_play()
//  var best_alpha = 0;
//  var best_win_rate = 0;
//
//  var alpha = 0;
//  var DIFF = 0.1;
//
//  while (alpha < 1) { // iterate through values for alpha
//    print("alpha = " + alpha);
//    var win_rate = 0;
//    for (i in [...Array(300)]) { // play 300 games per alpha setting
//      player_1_func = Math.random() <= alpha ? min_opp_and_max_play_mobility: chaser;
//      if (play_game(player_1_func, random_play, 3, 60) == 0) { // if white win
//        win_rate++;
//      }
//    }
//    print("win_rate = " + (win_rate / 300));
//    if (win_rate > best_win_rate) {
//      best_win_rate = win_rate;
//      best_alpha = alpha;
//    }
//    alpha += DIFF;
//  }
//
//
//  print("best_alpha = " + best_alpha);
//
//
//
//
// }

//  <div class="panel panel-default">
//   <div class="panel-heading">
//     <div class="row">
//       <div class="col-md-6">
//         <button type="button" class="btn btn-primary" onclick="run();">run()</button>
//       </div>
//       <div class="col-md-6 text-right">
//         <button type="button" class="btn btn-danger right-block" onclick="document.getElementById('run').innerHTML='>>> ';">Clear</button>
//       </div>
//     </div>
//   </div>
//   <div class="panel-body console-out">
//     <p id="run">>>> </p>
//   </div>
// </div>


-->
